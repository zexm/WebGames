(function(){function ia(){this.pointy=!0===(navigator.msMaxTouchPoints&&1<navigator.msMaxTouchPoints);this.touch=Modernizr.touch||this.pointy}function ja(){(this.useLocalStorage=Modernizr.localstorage)?this.storage=window.localStorage:(this.mute="false",this.background="true",this.highScore="0")}function ka(){this.muteIcon=$SVG("muteIcon");null===e.get("mute")&&e.set("mute",!1);this.muteAllElements(e.get("mute"))}function la(){this.backgroundElement=H.getElementById("background");this.blackElement=
H.getElementById("black");null===e.get("background")&&e.set("background",!0);e.get("background")?(this.backgroundElement.attributes.display.value="inline",this.blackElement.attributes.display.value="none"):(this.backgroundElement.attributes.display.value="none",this.blackElement.attributes.display.value="inline")}function T(){this.active=!1;this.countdown=60*(Math.floor(32*Math.random())+8);this.direction=-1;this.ufoElement=$SVG("ufo");this.ufoScoreGroup=$SVG("ufoScore");this.ufoScoreGroupMatrix=
this.ufoScoreGroup.transform.baseVal.getItem(0).matrix;this.ufoAudioElement=$DOM("ufoAudio");"undefined"!==typeof this.ufoAudioElement.loop&&(this.ufoAudioElement.loop=!0);this.ufoDeadAudio=$DOM("ufoDeadAudio");this.digitElements=this.ufoScoreGroup.getElementsByTagName("use");this.x=198;this.ufoElement.x.baseVal.value=198;this.ufoElement.y.baseVal.value=37;this.frames=0;this.displayingScore=this.exploding=!1;this.ufoScoreGroup.attributes.display.value="none";this.ufoElement.attributes.display.value=
"none";h&&!this.ufoAudioElement.paused&&this.ufoAudioElement.pause();h&&!this.ufoDeadAudio.paused&&this.ufoDeadAudio.pause()}function ma(){this.awarded=!1;this.count=3;this.livesGroup=$SVG("livesGroup");this.countElement=$SVG("livesCount");this.extraLifeAudio=$DOM("extraLifeAudio");this.render()}function na(){this.gameOverGroup=$SVG("gameOverGroup");this.gameOverGroupMatrix=this.gameOverGroup.transform.baseVal.getItem(0).matrix;this.letters=this.gameOverGroup.getElementsByTagName("path");this.active=
!1;this.letterDelay=8;this.letterIndex=this.frames=0;this.mourningTime=this.letterDelay*this.letters.length+120}function oa(){this.score=0;this.highScoreElement=$SVG("highScore");this.scoreElement=$SVG("score");null===e.get("highScore")&&e.set("highScore",0);this.render(e.get("highScore"),"highScore");this.render(this.score,"score")}function U(){this.invaderQueue=[];this.invaderArray=[];this.lowestInvaders=[];this.nextInvader=0;this.currentDirection=2;this.yOffset=0;this.nextBomb=120;this.bombFrequency=
16;this.BBox={};this.init()}function V(a,b){this.column=a;this.row=b;this.spriteA=!0;this.spriteAClip="url(#C"+Math.floor(this.row/2).toString()+"A)";this.spriteBClip="url(#C"+Math.floor(this.row/2).toString()+"B)";2>this.row?(this.xMin=0,this.xMax=12):4>this.row?(this.xMin=1,this.xMax=12):(this.xMin=2,this.xMax=10);this.position=a+11*b;this.spriteType=Math.floor(b/2);-1===b?(this.id="marker",this.active=!1):(this.element=W[this.position],this.clipPath=this.element.attributes["clip-path"],this.matrix=
this.element.transform.baseVal.getItem(0).matrix,this.matrix.e=26+16*a,this.matrix.f=m-16*b,this.id="invader"+this.position,this.active=!0,this.visible=!1);this.deadAlienAudio=$DOM("deadAlienAudio");this.direction=2;this.frames=0;this.invaderMask=new X([65535,65535,65535,65535,65535,65535,65535,65535],16)}function pa(){this.bulletRectElement=$SVG("bulletRect");this.bulletGroupElement=$SVG("bulletGroup");this.exploding=this.shooting=!1;this.bulletRectElement.attributes.display.value="none";this.x=
24;this.y=208;this.frame=0;this.audioElm=$DOM("shootAudio");this.bulletHoleMask=new X([137,34,126,255,255,126,36,145],8)}function qa(a,b,c){this.gunHitElement=$SVG("gunHit");this.delay=4;this.duration=16;this.frames=0;this.width=13;this.height=8;this.element=c;this.min=24;this.max=193;this.x=this.min;this.y=208;this.deadAudio=$DOM("deadAudio");this.active=!0;this.hasMoved=this.exploding=!1;this.gunHitElement.attributes.display.value="none";this.element.x.baseVal.value=this.x;this.element.y.baseVal.value=
this.y;this.element.attributes.display.value="inline"}function Ka(a){(32===a.keyCode||87===a.keyCode||38===a.keyCode||83===a.keyCode||40===a.keyCode)&&a.preventDefault()}function La(a){var b;b="undefined"===typeof window.event?a.keyCode:window.event.keyCode;70===b&&Y.show();66===b&&Z.toggle();if(77===b)$.toggle();else return ra(b,!0,a);a.preventDefault()}function Ma(a){return ra("undefined"===typeof window.event?a.keyCode:window.event.keyCode,!1,a)}function ra(a,b,c){if(65===a||37===a)D=b;else if(68===
a||39===a)E=b;else if(32===a||17===a||13===a)K=b;else if(80===a)L=b;else return!0;c.preventDefault();return!1}function sa(a,b,c){this.x=b+Math.round(Math.random());this.y=c;this.element=N.shift();this.element.attributes.d.value=a[0];this.element.attributes.opacity.value="1";this.element.attributes.fill.value="#FFF";this.element.attributes.display.value="inline";this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.matrix.e=this.x;this.matrix.f=this.y;this.active=!0;this.exploding=!1;this.fast=
!0;this.sprite=this.frame=0;this.path=a;this.craterMask=new X([12,38,13,30,46,31,46,21],6)}function aa(){if(this.active=176>m){this.barriers=[new M(32,184),new M(77,184),new M(122,184),new M(167,184)];for(var a=0;a<this.barriers.length;a++)this.barriers[a].render()}}function X(a,b){this.bitArray=a;this.height=a.length;this.width=b}function M(a,b){this.x=a;this.y=b;this.barrierBits=[262128,524280,1048572,2097150,4194303,4194303,4194303,4194303,4194303,4194303,4194303,4194303,4161791,4128895,4063295,
4063295];this.width=22;this.height=this.barrierBits.length;this.element=document.createElementNS(O,"path");this.element.setAttributeNS(null,"fill","url(#greenGradient)");this.element.setAttributeNS(null,"display","inline");this.element.setAttributeNS(null,"transform","translate("+this.x+","+this.y+")");this.render();this.barrierGroup=$SVG("barrierGroup");this.barrierGroup.appendChild(this.element)}function ta(){this.active=!1;this.marchSoundTimer=0;this.marchSoundDelay=960;this.audioElements=[$DOM("march1Audio"),
$DOM("march2Audio"),$DOM("march3Audio"),$DOM("march4Audio")];this.audioElementIndex=0;0!==this.marchSoundTimer&&clearTimeout(this.marchSoundTimer)}function ua(){this.text=$SVG("fps")}function va(){this.setup=!0;this.invaded=this.nextLevel=this.halted=this.paused=this.gameOverDisplaying=this.gameOver=this.playing=!1;$DOM("ufoAudio");h=(!s.touch||s.pointy)&&Modernizr.audio&&(Modernizr.audio.mp3||Modernizr.audio.ogg)}function wa(){Y=new ua;"undefined"===typeof e&&(e=new ja);"undefined"===typeof j&&(j=
new xa);d=new va;m=120;"undefined"===typeof t&&(t=new ta);l=new qa(18,-24,$SVG("gun"));I=new pa;"undefined"!==typeof u&&u.destroy();u=new aa;"undefined"!==typeof q&&q.destroyAll();q=new U;"undefined"===typeof F&&(F=new oa);F.score=0;"undefined"===typeof v&&(v=new ma);v.count=3;n=new T;Z=new la;$=new ka;ya=new na;0!==z&&clearInterval(z);z=setInterval(ba,100);0!==P&&clearInterval(P);P=setInterval(function(){Y.update()},500);s.touch&&(g.hide(),k.hide(),G.hide(),ca.show(),j.Resize());d.setup?d.doSetup():
(d.playing=!0,d.paused=!0)}function ba(){for(var a=0;2>a;a++)B=0===a,this.frameCount++,L&&(d.playing||d.paused)?d.pause():d.halted?d.halt():d.gameOver?(h&&!n.ufoAudioElement.paused&&n.ufoAudioElement.pause(),clearInterval(P),t.stop(),d.reset(),d.gameOverDisplaying=!0):d.invaded?l.render():d.playing&&!d.paused?(l.move(),l.render(),I.move(),I.render(),q.moveAndRender(),n.moveAndRender(),"undefined"!==typeof p&&p.moveAndRender(),"undefined"!==typeof w&&w.moveAndRender()):d.nextLevel&&(u.destroy(),u=
new aa,q=new U,n=new T,t.start(),l.x=l.min,l.hasMoved=!0,d.reset(),d.playing=!0),d.gameOverDisplaying&&ya.render()}function xa(){this.svgRatio=224/240;this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight;this.midY=this.windowWidth/2;this.windowRatio=this.windowWidth/this.windowHeight;this.isLandscape=this.windowRatio>=this.svgRatio}function Na(a){a.stopPropagation();a.preventDefault();"undefined"!==typeof Q&&Q&&clearTimeout(Q);Q=setTimeout(function(){j.Resize()},100)}function za(){this.element=
$DOM("pauseButton");this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.display=this.element.attributes.display;this.x=this.matrix.e;this.y=this.matrix.f}function Aa(){this.element=$DOM("playButton");this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.display=this.element.attributes.display;this.x=this.matrix.e;this.y=this.matrix.f}function Ba(){this.element=$DOM("joystickButton");this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.display=this.element.attributes.display;
this.x=this.matrix.e;this.y=this.matrix.f;this.id=-1}function Ca(){this.element=$DOM("joystick");this.joystickButtonPath=$DOM("joystickButtonPath");this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.display=this.element.attributes.display;this.id=-1;this.button=new Ba}function Da(){this.element=$DOM("fireButton");this.fireButtonPath=$DOM("fireButtonPath");this.matrix=this.element.transform.baseVal.getItem(0).matrix;this.display=this.element.attributes.display;this.x=this.matrix.e;this.y=
this.matrix.f;this.id=-1}function Ea(){g.move(10-r,x-35);k.move(y-41-r,x-41);k.fireButtonPath.attributes.fill.value="#888";g.joystickButtonPath.attributes.fill.value="#888"}function Oa(){this.element=$DOM("touchCanvas");$DOM("touchCanvas").style.display="inline";this.element.addEventListener("touchstart",Pa,!1);this.element.addEventListener("touchend",da,!1);this.element.addEventListener("touchcancel",Qa,!1);this.element.addEventListener("touchleave",Ra,!1);this.element.addEventListener("touchmove",
Sa,!1);s.pointy&&(this.element.addEventListener("MSPointerDown",Ta,!1),this.element.addEventListener("MSPointerMove",Ua,!1),this.element.addEventListener("MSPointerUp",ea,!1),this.element.addEventListener("MSPointerOut",ea,!1),this.element.addEventListener("MSPointerCancel",ea,!1),this.element.addEventListener("MSGestureHold",function(a){a.preventDefault()},!1),this.element.addEventListener("contextmenu",function(a){a.preventDefault()},!1))}function Pa(a){a.preventDefault();var b=a.changedTouches;
if("undefined"!==typeof b){a.stopPropagation();for(a=0;a<b.length;a++){var c=y/j.windowWidth*b[a].pageX-r,f=x/j.windowHeight*b[a].pageY;if(G.hitTest(c,f)){L=!0;break}else b[a].pageX<j.midY&&-1===g.id?(g.move(c-29,f-12),g.id=b[a].identifier):b[a].pageX>j.midY&&-1===k.id&&(k.move(c-17,f-17),k.id=b[a].identifier,K=!0)}return!1}}function Ta(a){a.preventDefault();if(a.pointerType===a.MSPOINTER_TYPE_TOUCH){a.stopPropagation();fa[a.pointerId]=!0;var b=y/j.windowWidth*a.clientX-r,c=x/j.windowHeight*a.clientY;
G.hitTest(b,c)?L=!0:a.clientX<j.midY&&-1===g.id?(g.move(b-29,c-12),g.id=a.pointerId):a.clientX>j.midY&&-1===k.id&&(k.move(b-17,c-17),k.id=a.pointerId,K=!0);return!1}}function da(a){a.preventDefault();var b=a.changedTouches;if("undefined"!==typeof b){a.stopPropagation();for(a=0;a<b.length;a++)b[a].identifier===g.id?g.touchEnd():b[a].identifier===k.id&&k.touchEnd()}}function ea(a){a.preventDefault();a.pointerType===a.MSPOINTER_TYPE_TOUCH&&(a.stopPropagation(),fa[a.pointerId]=!1,a.pointerId===g.id?g.touchEnd():
a.pointerId===k.id&&k.touchEnd())}function Qa(a){a.preventDefault();da(a)}function Ra(a){a.preventDefault();da(a)}function Fa(a,b){var c=g.matrix.e;E=D=!1;var f=y/j.windowWidth*a-r-29;f<c?(D=!0,f<c-16&&(g.matrix.e-=c-16-f)):f>c?(E=!0,f>c+16&&(g.matrix.e+=f-(c+16))):E=D=!1;g.move(g.matrix.e,x/j.windowHeight*b-12);g.moveButton(f)}function Sa(a){a.preventDefault();a=a.changedTouches;if("undefined"!==typeof a)for(var b=0;b<a.length;b++)if(a[b].identifier===g.id){Fa(a[b].pageX,a[b].pageY);break}}function Ua(a){a.preventDefault();
fa[a.pointerId]&&a.pointerId===g.id&&Fa(a.clientX,a.clientY)}function Ga(){this.aboutPanel=$DOM("aboutPanel");this.controlsPanel=$DOM("controlsPanel")}var O="http://www.w3.org/2000/svg",R,J,H,e,d,j,S,h=!1,B,G,ca,g,k,ga,r,y,x,fa={},z=0,P=0,Va=100/3,Ha,Q,Ia=0,Ja=0,ha=!1,Y,D=!1,E=!1,K=!1,L=!1,l,I,q,F,v,n,ya,Z,$,p,w,u,t,m,W,Wa=["#F0F","#0FF","#0F0","#FF0","#F00"],Xa=["M2,0v1h1v-1h-1zm0,1h-1v1h1v-1zm-1,1h-1v1h1v-1zm0,1v1h1v-1h-1zm1,1v1h1v-1h-1zm0,1h-1v1h1v-1zm-1,1h-1v1h1v-1z","M1,0v1h1v-1h-1zm0,1h-1v1h1v-1zm0,1v1h1v-1h-1zm1,1v1h1v-1h-1zm0,1h-1v1h1v-1zm-1,1h-1v1h1v-1zm0,1v1h1v-1h-1z",
"M0,0v1h1v-1h-1zm1,1v1h1v-1h-1zm1,1v1h1v-1h-1zm0,1h-1v1h1v-1zm-1,1h-1v1h1v-1zm0,1v1h1v-1h-1zm1,1v1h1v-1h-1z","M1,0,1,1,2,1,2,0,1,0zm1,1,0,1,1,0,0-1-1,0zm0,1-1,0,0,1,1,0,0-1zm-1,1-1,0,0,1,1,0,0-1zm0,1,0,1,1,0,0-1-1,0zm1,1,0,1,1,0,0-1-1,0zm0,1-1,0,0,1,1,0,0-1z"],Ya=["M0,0v1h1v6h1v-6h1v-1h-3z","M1,0v2h-1v1h1v4h1v-4h1v-1h-1v-2h-1z","M1,0v4h-1v1h1v2h1v-2h1v-1h-1v-4h-1z","M1,0v6h-1v1h1,1,1v-1h-1v-6h-1z"],N=[],A;ia.prototype={DOM:function(a){return document.getElementById(a)},SVG:function(a){return R.getElementById(a)}};
var s=new ia;ja.prototype={set:function(a,b){if(this.useLocalStorage)this.storage.setItem(a,JSON.stringify(b));else switch(a){case "mute":this.mute=JSON.stringify(b);break;case "background":this.background=JSON.stringify(b);break;case "highScore":this.highScore=JSON.stringify(b)}},get:function(a){if(this.useLocalStorage)return JSON.parse(this.storage.getItem(a));switch(a){case "mute":return JSON.parse(this.mute);case "background":return JSON.parse(this.background);case "highScore":return JSON.parse(this.highScore);
default:return null}}};ka.prototype={muteAllElements:function(a){this.muteIcon.attributes.display.value=a?"inline":"none";if(h){n.ufoAudioElement.muted=a;n.ufoDeadAudio.muted=a;v.extraLifeAudio.muted=a;q.invaderArray[0].deadAlienAudio.muted=a;l.deadAudio.muted=a;I.audioElm.muted=a;for(var b=0;b<t.audioElements.length;b++)t.audioElements[b].muted=a}},toggle:function(){e.set("mute",!e.get("mute"));this.muteAllElements(e.get("mute"))}};la.prototype={toggle:function(){e.set("background",!e.get("background"));
e.get("background")?(this.blackElement.attributes.display.value="none",this.backgroundElement.attributes.display.value="inline"):(this.blackElement.attributes.display.value="inline",this.backgroundElement.attributes.display.value="none")}};T.prototype={start:function(){d.playing&&9<q.invaderQueue.length&&(-1===this.direction?(this.x=198,this.ufoElement.x.baseVal.value=198):(this.x=16,this.ufoElement.x.baseVal.value=16),this.active=!0,h&&!this.ufoAudioElement.muted&&this.ufoAudioElement.play(),this.ufoElement.attributes.display.value=
"inline")},reset:function(){this.active=!1;h&&!this.ufoAudioElement.paused&&this.ufoAudioElement.pause();this.ufoElement.attributes.display.value="none";this.direction=0.5>Math.random()?1:-1;this.countdown=60*(Math.floor(32*Math.random())+8)},moveAndRender:function(){this.active?B||(this.x+=1.5*this.direction,this.ufoElement.x.baseVal.value=this.x,(12>this.x||198<this.x)&&this.reset()):(this.countdown--,0===this.countdown&&this.start());this.displayingScore&&(0===this.frames?(this.displayingScore=
!1,this.ufoScoreGroup.attributes.display.value="none"):(110===this.frames&&(this.ufoScoreGroup.attributes.display.value="inline"),this.frames--))},ufoSound:function(){h&&(this.active&&!this.exploding&&!this.ufoAudioElement.muted)&&this.ufoAudioElement.play()},displayScore:function(a,b,c){this.displayingScore=!0;this.frames=130;this.ufoScoreGroupMatrix.e=b-3;this.ufoScoreGroupMatrix.f=c-6;50===a?(this.digitElements[0].attributes.display.value="none",this.digitElements[1].href.baseVal="#Digit5",this.digitElements[2].href.baseVal=
"#Digit0"):(a=""+a,this.digitElements[0].attributes.display.value="inline",this.digitElements[0].href.baseVal="#Digit"+a.substring(0,1),this.digitElements[1].href.baseVal="#Digit"+a.substring(1,2),this.digitElements[2].href.baseVal="#Digit"+a.substring(2,3))},hitTest:function(a,b){if(this.active&&44>b&&37<b&&a>=this.x&&a<this.x+16){h&&!this.ufoDeadAudio.muted&&this.ufoDeadAudio.play();this.explode();var c=50*Math.round(6*Math.random()+0.5);F.add(c);this.displayScore(c,Math.floor(this.x),37);this.reset();
return!0}return!1},explode:function(){h&&!this.ufoAudioElement.paused&&this.ufoAudioElement.pause();this.exploding=!0;this.active=!1}};ma.prototype={add:function(){this.awarded||(this.count+=1,this.awarded=!0,this.render(),this.sound())},deduct:function(){this.count-=1;this.render()},render:function(){this.countElement.href.baseVal="#Digit"+this.count;for(var a=this.livesGroup.getElementsByTagName("use"),b=a.length,c=1;c<b;c++)this.livesGroup.removeChild(a[1]);for(c=1;c<this.count;c++)a=document.createElementNS(O,
"use"),a.id="gunLife"+c,a.href.baseVal="#GunPath",a.x.baseVal.value=16+16*c,a.y.baseVal.value=231,this.livesGroup.appendChild(a)},reset:function(){this.count=3;this.render()},sound:function(){h&&!this.extraLifeAudio.muted&&this.extraLifeAudio.play()}};na.prototype={render:function(){this.active||(this.reset(),this.active=!0);this.active&&0===this.frames%this.letterDelay&&8>this.letterIndex&&(this.letters[this.letterIndex].attributes.display.value="inline",this.letterIndex++);this.frames>this.mourningTime&&
(this.active=!1,this.reset(),d.reset(),d.halted=!0);this.frames++},reset:function(){for(var a=this.letterIndex=0;8>a;a++)this.letters[a].attributes.display.value="none";this.gameOverGroupMatrix.e=73;this.gameOverGroupMatrix.f=49}};oa.prototype={updateByInvader:function(a){this.add(10*(Math.floor(a.row/2)+1))},add:function(a){this.score+=a;this.render(this.score,"score");this.score>e.get("highScore")&&(e.set("highScore",this.score),this.render(this.score,"highScore"));!v.awarded&&1500<=this.score&&
v.add()},padLeft:function(a,b,c){return(""+a).length>=b?""+a:this.padLeft(c+a,b,c)},render:function(a,b){var c=this.padLeft(a,4,"0"),f,C;"score"===b?(C=this.scoreElement,f=25):(C=this.highScoreElement,f=89);for(var d=C.getElementsByTagName("use"),g=d.length,e=0;e<g;e++)C.removeChild(d[0]);for(e=0;e<c.length;e++)d=document.createElementNS(O,"use"),d.id=b+e,d.href.baseVal="#Digit"+c[e],d.x.baseVal.value=f+8*e,d.y.baseVal.value=16,d.setAttributeNS(null,"fill","#8FF"),C.appendChild(d)}};U.prototype={moveAndRender:function(){if(1===
this.invaderQueue.length)d.reset(),d.nextLevel=!0;else{var a=this.invaderQueue.shift();"marker"===a.id&&(this.yOffset=0,this.invaderQueue.push(a),this.dropBombs(),this.BBox=this.getBBox(),this.changeDirection(),a=this.invaderQueue.shift());a.move(this.currentDirection,this.yOffset);a.render();this.invaderQueue.push(a)}this.nextBomb--},getBBox:function(){for(var a=224,b=0,c=240,f=0,C,d,e=0;e<this.invaderQueue.length;e++)if("marker"!==this.invaderQueue[e].id){var g=this.invaderQueue[e].matrix.e,h=this.invaderQueue[e].matrix.f;
g<a&&(C=this.invaderQueue[e],a=g);h<c&&(d=this.invaderQueue[e],c=h);g>b&&(b=g);h>f&&(f=h)}return{xMin:a,xMax:b+12,yMin:c,yMax:f+8,xMinInvader:C,yMinInvader:d}},destroy:function(a){this.invaderQueue.splice(a,1)[0].destroy()},destroyAll:function(){for(var a=0;5>a;a++)for(var b=0;11>b;b++)this.invaderArray[11*a+b].destroy()},init:function(){for(var a=0;5>a;a++)for(var b=0;11>b;b++){var c=new V(b,a);this.invaderQueue.push(c);this.invaderArray[11*a+b]=c}this.invaderQueue.push(new V(112,-1));120===m?m+=
24:144===m?m+=16:176>m&&(m+=8)},changeDirection:function(){12>this.BBox.xMin&&2!==this.currentDirection&&(this.currentDirection=2,this.yOffset=8);213<this.BBox.xMax&&-2!==this.currentDirection&&(this.currentDirection=-2,this.yOffset=8)},invadersHitTest:function(a,b){var c=!1;if(b>=this.BBox.yMin&&b<=this.BBox.yMax+2&&a>=this.BBox.xMin-2&&a<this.BBox.xMax+2){var f=this.invaderAtXY(a,b);if(c=f.active&&f.hitTest(a,b)){F.updateByInvader(f);for(var d=0;d<this.invaderQueue.length;d++)if(f.id===this.invaderQueue[d].id){this.destroy(d);
break}}}return c},invaderAtXY:function(a,b){var c=Math.floor((a-this.BBox.xMin)/16)+this.BBox.xMinInvader.column,f=4-(Math.floor((b-this.BBox.yMin)/16)+(4-this.BBox.yMinInvader.row));0>c&&(c=0);10<c&&(c=10);0>f&&(f=0);4<f&&(f=4);return this.invaderArray[11*f+c]},shift:function(a){for(var b=0;b<this.invaderQueue.length;b++)this.invaderQueue[b].matrix.e+=a},findLowestInvaders:function(){this.lowestInvaders=[];for(var a=0;11>a;a++)for(var b=0;5>b;b++){var c=this.invaderArray[11*b+a];if(c.active){this.lowestInvaders.push(c);
break}}},findNearestInvader:function(a){for(var b,c=240,f=0;f<this.invaderQueue.length-1;f++)"marker"!==this.invaderQueue[f].id&&Math.abs(this.invaderQueue[f].matrix.e-a)<c&&(b=this.invaderQueue[f],c=Math.abs(this.invaderQueue[f].matrix.e-a));return b},findNextBomber:function(){this.findLowestInvaders();var a=Math.random();return 1<3*a?this.lowestInvaders[Math.floor(this.lowestInvaders.length*a)]:this.findNearestInvader(l.x)},dropBombs:function(){if(0>=this.nextBomb&&("undefined"===typeof p||"undefined"===
typeof w||!p.active||!w.active)){var a=this.findNextBomber(),b=0.5<Math.random()?Xa:Ya,a=new sa(b,a.matrix.e+4,a.matrix.f);"undefined"===typeof p||!p.active?p=a:w=a;this.nextBomb=Math.floor(Math.random()*this.bombFrequency)+4}}};V.prototype={move:function(a,b){this.direction!==a?this.direction=a:this.matrix.e+=this.direction;b&&(this.matrix.f+=b);200<this.matrix.f&&(d.reset(),d.invaded=!0,l.hit());184<=this.matrix.f&&u.applyMask(this.invaderMask,this.matrix.e-2,this.matrix.f)},render:function(){this.clipPath.value=
this.spriteA?this.spriteAClip:this.spriteBClip;this.spriteA=!this.spriteA;this.visible||(this.element.attributes.display.value="inherit",this.visible=!0)},destroy:function(){this.element.attributes.display.value="none";this.visible=this.active=!1},hitTest:function(a,b){var c=!1;if("marker"!==this.element.id){var c=a-this.matrix.e,f=b-this.matrix.f;if(c=c>=this.xMin&&c<this.xMax&&0<f&&8>f)this.sound(),this.invaderExplode()}return c},invaderExplode:function(){I.x=this.matrix.e;I.y=this.matrix.f;this.active=
!1},sound:function(){h&&!this.deadAlienAudio.muted&&this.deadAlienAudio.play()}};pa.prototype={move:function(){l.active&&(!l.exploding&&K&&!this.shooting&&!this.exploding)&&(K=!1,this.sound(),this.shooting=!0,this.exploding=!1,this.bulletRectElement.attributes.display.value="inline",this.x=l.x,this.bulletRectElement.x.baseVal.value=this.x);var a=!1;this.shooting?(this.y-=4,32>this.y?this.bulletExplode("#BulletZap","#F00",this.x-3,this.y-2):(a=u.hitTest(this.x,this.y,!1))?(u.applyMask(this.bulletHoleMask,
this.x-4,a-5),this.bulletExplode("#BulletZap","#0F0",this.x-4,a-5)):44>this.y&&n.hitTest(this.x,this.y)?this.bulletExplode("#UfoZap",null,n.ufoElement.x.baseVal.value-2,n.ufoElement.y.baseVal.value-5):q.invadersHitTest(this.x,this.y)?this.bulletExplode("#InvaderZap",null,this.x,this.y):"undefined"!==typeof p&&p.hitTest(this.x,this.y)?this.bulletExplode("#BulletZap","#FFF",this.x-3,this.y):"undefined"!==typeof w&&w.hitTest(this.x,this.y)&&this.bulletExplode("#BulletZap","#FFF",this.x,this.y)):this.exploding&&
(0===this.frames?this.destroy():(B||(A.attributes.opacity.value=this.frames/16),this.frames--))},render:function(){this.shooting&&!B&&(this.bulletRectElement.y.baseVal.value=this.y)},destroy:function(){this.exploding=this.shooting=!1;A.attributes.display.value="none";this.bulletRectElement=$SVG("bulletRect");this.y=208},sound:function(){h&&!this.audioElm.muted&&this.audioElm.play()},bulletExplode:function(a,b,c,f){this.shooting=!1;this.exploding=!0;this.bulletRectElement.attributes.display.value=
"none";A.href.baseVal=a;"undefined"!==typeof b&&null!==b&&(A.attributes.fill.value=b);A.x.baseVal.value=c;A.y.baseVal.value=f;A.attributes.opacity.value=1;A.attributes.display.value="inline";this.frames=16}};qa.prototype={hit:function(){this.exploding||(h&&!this.deadAudio.muted&&this.deadAudio.play(),this.exploding=!0);0===Math.floor(this.frames/this.delay)%2?(this.gunHitElement.href.baseVal="#GunHitPathA",this.gunHitElement.attributes.opacity.value=(64-this.frames)/64):this.gunHitElement.href.baseVal=
"#GunHitPathB";0===this.frames&&(this.gunHitElement.x.baseVal.value=this.x-8,this.element.attributes.display.value="none",this.gunHitElement.attributes.display.value="inline");this.frames++;this.frames>this.duration*this.delay&&(d.invaded||0===v.count?(d.reset(),d.gameOver=!0):this.reincarnate(),this.frames=0,this.exploding=!1,this.gunHitElement.attributes.display.value="none")},hitTest:function(a,b){if(this.exploding)return!1;var c=b+8>this.y&&b<this.y&&a>this.x-8&&a<this.x+5;c&&(v.deduct(),0<v.count&&
(q.nextBomb+=120),this.hit());return c},reincarnate:function(){this.x=this.min;this.y=208;this.exploding=!1;this.element.attributes.display.value="inline";this.hasMoved=!0;B=!1;this.render()},render:function(){this.exploding?this.hit():!B&&this.hasMoved&&(this.element.x.baseVal.value=this.x,this.element.y.baseVal.value=this.y,this.hasMoved=!1)},move:function(){if(!this.exploding&&this.active&&(!E||!D))D&&this.x>this.min?(this.hasMoved=!0,this.x-=1):E&&this.x<this.max&&(this.hasMoved=!0,this.x+=1)}};
sa.prototype={moveAndRender:function(){var a=!1;if((d.gameOver||d.nextLevel)&&(this.active||this.exploding))this.frames=0,this.destroy();else if(this.exploding)0===this.frames?this.destroy():(B||(this.element.attributes.opacity.value=this.frames/16),this.frames--);else if(this.active)if(this.y=this.y+1+this.fast,this.fast=!this.fast,221<this.y)this.bombExplode("M2,1v1h1v-1h-1zm-2,1v1h1v-1h-1zm4,0v1h1v-1h-1zm1,1v1h1v-1h-1zm0,1h-1v-1h-2v1h-1v1h1v1h-1v1h1v1h3v-1h1v-1h-1v-2zm-4,3h-1v1h1v-1zm0-1v-1h-1v1h1z",
"#0F0");else if(l.hitTest(this.x,this.y))this.destroy(),"undefined"!==typeof w&&w.active&&w.destroy(),"undefined"!==typeof p&&p.active&&p.destroy();else{var b=this.sprite%3-1;if(a=u.hitTest(this.x+b,this.y+7,!0))this.y=a-5+Math.floor(4*Math.random()),u.applyMask(this.craterMask,this.x+b-this.craterMask.width/2,this.y),this.bombExplode("M2,2v1h1v-1h-1zm1,1v1h-1v1h-1v1h1v1h1v1h1v-1h1v-1h1v-1h-1v-1-1h-1-1zm2,0h1v-1h-1v1zm0,4v1h1v-1h-1zm-3,0h-1v1h1v-1zm-1,0v-1h-1v1h1zm0-2v-1h-1v1h1zm0-1h1v-1h-1v1z","#0F0")}this.render()},
render:function(){!B&&(this.active&&!this.exploding)&&(this.matrix.f=this.y,this.element.attributes.d.value=this.path[this.sprite],this.sprite=(this.sprite+1)%4)},destroy:function(){this.exploding=this.active=!1;this.frames=0;N.push(this.element);this.element.attributes.display.value="none"},bombExplode:function(a,b){this.exploding=!0;this.element.attributes.d.value=a;this.element.attributes.fill.value=b;this.x-=this.craterMask.width/2;this.matrix.e=this.x;this.matrix.f=this.y;this.frames=16;this.sprite=
0},hitTest:function(a,b){return this.active&&!this.exploding&&b<=this.y&&b<=this.y-7&&a>=this.x&&a<this.x+3?(this.x=a,this.y=b,this.bombExplode("M2,2v1h1v-1h-1zm1,1v1h-1v1h-1v1h1v1h1v1h1v-1h1v-1h1v-1h-1v-1-1h-1-1zm2,0h1v-1h-1v1zm0,4v1h1v-1h-1zm-3,0h-1v1h1v-1zm-1,0v-1h-1v1h1zm0-2v-1h-1v1h1zm0-1h1v-1h-1v1z","#FFF"),!0):!1}};aa.prototype={hitTest:function(a,b,c){if(this.active){for(var f=!1,d=0;d<this.barriers.length&&(!(a>=this.barriers[d].x&&a<this.barriers[d].x+this.barriers[d].width&&b>=this.barriers[d].y&&
b<this.barriers[d].y+this.barriers[d].height)||!(f=c?this.barriers[d].bombHitTest(a,b):this.barriers[d].bulletHitTest(a,b)));d++);return f}return!1},destroy:function(){if(this.active)for(var a=0;a<this.barriers.length;a++)this.barriers[a].destroy()},applyMask:function(a,b,c){if(this.active)for(var f=0;f<this.barriers.length;f++)if(b+a.width>this.barriers[f].x&&b<this.barriers[f].x+this.barriers[f].width){this.barriers[f].applyMask(a,b,c);break}}};M.prototype={bitsToPath:function(a,b){for(var c=[""],
f=0,d=0;d<a.length;d++)for(var e=b-1;-1<e;e--)f=b-1-e,0<(1<<e&a[d])&&c.push("M"+f+","+d+"v1h1v-1z");return c.join("")},render:function(){var a=this.bitsToPath(this.barrierBits,this.width);this.element.setAttributeNS(null,"d",a)},bulletHitTest:function(a,b){for(var c=a-this.x,d=b-this.y,e=d+3<this.height?3:this.y+this.height-1-b;-1<e;e--)if(0<(this.barrierBits[d+e]&1<<this.width-1-c))return this.y+d+e;return!1},bombHitTest:function(a,b){var c=a-this.x,d=b-this.y;return 0>d?!1:d<this.height&&0<(this.barrierBits[d]&
1<<this.width-1-c)?b:d+1<this.height&&0<(this.barrierBits[d+1]&1<<this.width-1-c)?b+1:!1},applyMask:function(a,b,c){if(!(c+a.height<this.y||this.y+this.height<c||b+a.width<this.x||this.x+this.width<b)){var d=c>this.y?0:this.y-c,e=c>this.y?c-this.y:0;c=c+a.height>=this.y+this.height?this.height:c+a.height-this.y;b=this.width-a.width-(b-this.x);for(var g=0;g<c-e;g++){var h=a.bitArray[g+d],h=0<b?h<<b:h>>-b;this.barrierBits[g+e]&=~h}this.render()}},destroy:function(){this.barrierGroup.removeChild(this.element)}};
ta.prototype={start:function(){0!==this.marchSoundTimer&&clearTimeout(this.marchSoundTimer);this.marchSoundTimer=setTimeout(function(){t.event()},this.marchSoundDelay);this.active=!0},stop:function(){0!==this.marchSoundTimer&&clearTimeout(this.marchSoundTimer);this.active=!1},event:function(){d.playing?(this.audioElementIndex=(this.audioElementIndex+1)%4,h&&!this.audioElements[this.audioElementIndex].muted&&(this.audioElements[this.audioElementIndex].currentTime=0,this.audioElements[this.audioElementIndex].play()),
this.marchSoundDelay=920*(q.invaderQueue.length/56)+40,this.start()):0!==this.marchSoundTimer&&clearTimeout(this.marchSoundTimer)}};ua.prototype={update:function(){var a=(new Date).getTime();Ha=(1E3*(Ia/(a-Ja))).toFixed(2);this.text.firstChild.nodeValue="FPS: "+Ha;Ja=a;Ia=0},show:function(){ha?(this.text.attributes.display.value="none",ha=!1):(this.text.attributes.display.value="inline",ha=!0)}};va.prototype={reset:function(){this.invaded=this.nextLevel=this.halted=this.paused=this.gameOverDisplaying=
this.gameOver=this.playing=!1},doSetup:function(){this.setup=!1;$SVG("paused").attributes.display.value="inline";J.attributes.display.value="inline";$SVG("credit1").href.baseVal="#Digit1";this.paused=!0},halt:function(){this.halted=!1;J.attributes.display.value="inline";wa()},pause:function(){var a=$SVG("paused");L=!1;d.paused?(0!==z&&clearInterval(z),z=setInterval(ba,Va),t.start(),a.attributes.display.value="none",J.attributes.display.value="none",$SVG("credit1").href.baseVal="#Digit0",this.paused=
!1,F.render(F.score,"score"),v.render(),s.touch&&(Ea(),g.show(),k.show(),G.show()),S.aboutclick(),this.playing=!0):(0!==z&&clearInterval(z),z=setInterval(ba,100),h&&0!==n.ufoAudioElement.readyState&&n.ufoAudioElement.pause(),t.active&&t.stop(),a.attributes.display.value="inline",J.attributes.display.value="inline",s.touch&&(g.hide(),k.hide(),G.hide()),this.reset(),this.paused=!0)}};xa.prototype={Resize:function(){this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight;this.midY=this.windowWidth/
2;this.windowRatio=this.windowWidth/this.windowHeight;(this.isLandscape=this.windowRatio>=this.svgRatio)?(y=Math.floor(240*this.windowRatio),x=240,r=Math.floor((y-224)/2)):(y=224,x=Math.floor(224/this.windowRatio),r=0);G.resize();ca.resize();ga.element.width=y;ga.element.height=x;Ea()}};za.prototype={resize:function(){j.isLandscape?(this.matrix.e=y-24-r,this.matrix.f=8):(this.matrix.e=r+100,this.matrix.f=x-24);this.x=this.matrix.e;this.y=this.matrix.f},show:function(){this.display.value="inline"},
hide:function(){this.display.value="none"},hitTest:function(a,b){return b>=this.y&&a>=this.x&&b<=this.y+25&&a<=this.x+25}};Aa.prototype={resize:function(){j.isLandscape?(this.matrix.e=y-24-r,this.matrix.f=8):(this.matrix.e=r+100,this.matrix.f=x-24);this.x=this.matrix.e;this.y=this.matrix.f},show:function(){this.display.value="inline"},hide:function(){this.display.value="none"}};Ba.prototype={show:function(){this.display.value="inline"},hide:function(){this.display.value="none"}};Ca.prototype={show:function(){this.display.value=
"inline";this.button.show()},hide:function(){this.display.value="none";this.button.hide()},move:function(a,b){this.button.matrix.e=this.matrix.e=a;this.button.matrix.f=this.matrix.f=b;this.joystickButtonPath.attributes.fill.value="#FFF"},touchEnd:function(){E=D=!1;this.id=-1;this.button.matrix.e=this.matrix.e;this.joystickButtonPath.attributes.fill.value="#888"},moveButton:function(a){this.button.matrix.e=a}};Da.prototype={show:function(){this.display.value="inline"},hide:function(){this.display.value=
"none"},move:function(a,b){this.matrix.e=a;this.matrix.f=b;this.fireButtonPath.attributes.fill.value="#FFF"},touchEnd:function(){this.id=-1;this.fireButtonPath.attributes.fill.value="#888"}};Ga.prototype={controlsclick:function(){this.aboutPanel.attributes.display.value="none";this.controlsPanel.attributes.display.value="inline";return!1},aboutclick:function(){this.aboutPanel.attributes.display.value="inline";this.controlsPanel.attributes.display.value="none";return!1}};ready(function(){document.title=
"Space InVectors";window.$DOM=s.DOM;R=$DOM("InVectors");window.$SVG=s.SVG;if(Modernizr.svg){$DOM("invadersBody").style.background="url(../Images/Texture2.png) repeat";$DOM("waitDiv").style.display="none";$DOM("svgDiv").style.display="inline";$DOM("sorry").style.display="none";J=$DOM("TitleSvg");H=$DOM("BackSVG");$SVG("bombGroup");N.push($SVG("bomb1Element"));N.push($SVG("bomb2Element"));A=$SVG("bulletExplode");s.touch&&(R.preserveAspectRatio.baseVal.align=R.preserveAspectRatio.baseVal.SVG_PRESERVEASPECTRATIO_XMIDYMIN,
H.preserveAspectRatio.baseVal.align=H.preserveAspectRatio.baseVal.SVG_PRESERVEASPECTRATIO_XMIDYMIN,J.preserveAspectRatio.baseVal.align=H.preserveAspectRatio.baseVal.SVG_PRESERVEASPECTRATIO_XMIDYMIN);var a=$SVG("invaderGroup");W=[];for(var b=0;5>b;b++)for(var c=0;11>c;c++){var f=11*b+c,e=document.createElementNS(O,"rect");e.setAttributeNS(null,"id","invader"+f);e.setAttributeNS(null,"display","none");e.setAttributeNS(null,"transform","matrix(1 0 0 1 "+(16*c+26).toString()+" "+(120-16*b).toString()+
")");e.setAttributeNS(null,"width","12");e.setAttributeNS(null,"height","8");e.setAttributeNS(null,"fill",Wa[b]);e.setAttributeNS(null,"clip-path","url(#C"+Math.floor(b/2).toString()+"A)");e.setAttributeNS(null,"stroke","none");W.push(e);a.appendChild(e)}document.addEventListener("keydown",La,!0);document.addEventListener("keyup",Ma,!0);document.addEventListener("keypress",Ka,!1);s.touch&&(ga=new Oa,G=new za,ca=new Aa,g=new Ca,k=new Da,window.addEventListener("resize",Na,!1));S=new Ga;$DOM("playlink").addEventListener("click",
function(){d.pause()},!1);$DOM("controlslink").addEventListener("click",function(){S.controlsclick()},!1);$DOM("aboutlink").addEventListener("click",function(){S.aboutclick()},!1);$DOM("playButton").addEventListener("click",function(){d.pause()},!1);$DOM("bkeylink").addEventListener("click",function(){Z.toggle()},!1);$DOM("mkeylink").addEventListener("click",function(){$.toggle()},!1);$DOM("pkeylink").addEventListener("click",function(){d.pause()},!1);wa()}else $DOM("waitDiv").style.display="none",
$DOM("svgDiv").style.display="none",$DOM("sorry").style.display="inline"})})();